<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>온라인 출입 시스템</title>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="apple-touch-icon" href="apple-icon-precomposed.png">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="msapplication-config" content="browserconfig.xml">
  <link rel="manifest" href="manifest.json">

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<h1>휴 일 출 입 증<br>GIẤY XÁC NHẬN VÀO TRƯỜNG</h1>

<div id="personalForm">

  <label>학번(Mã số lớp)</label>
  <input id="studentId" placeholder="학번을 입력하세요" />

  <label>이름(Họ tên)</label>
  <input id="studentName" placeholder="이름을 입력하세요" />

  <label>날짜(Ngày hôm nay)</label>
  <input type="date" id="date" />

  <label>사유(Lý do)</label>
  <input id="reason" placeholder="사유를 직접 입력하세요" />

  <label>지도교사(GV chủ nhiệm)</label>
  <select id="teacher">
    <option>선택</option>
    <option>권은숙</option><option>김다성</option><option>김민석</option><option>김민규</option>
    <option>김보관</option><option>김보연</option><option>김선옥</option><option>김성훈</option>
    <option>김수정</option><option>김은숙</option><option>김태권</option><option>김하정</option>
    <option>남현정</option><option>문준배</option><option>박미란</option><option>박은영</option>
    <option>박현숙</option><option>서윤정</option><option>송유나</option><option>신동욱</option>
    <option>신세림</option><option>안예린</option><option>양주연</option><option>오늘동</option>
    <option>우민석</option><option>유리아나</option><option>윤진아</option><option>이근정</option>
    <option>이명기</option><option>이슬영</option><option>이유준</option><option>이지연</option>
    <option>이혜원</option><option>임하영</option><option>임희정</option><option>정예진</option>
    <option>정다연</option><option>정명선</option><option>정성연</option><option>조민정</option>
    <option>조진석</option><option>조희성</option><option>한선우</option><option>한지윤</option>
    <option>황사라</option><option>황지혁</option>
  </select>

  <button id="generateQR">QR 생성</button>
</div>

<div id="qrBox" style="display:none; margin-top:2rem;">
  <h2>QR을 스캔하면 출입증이 표시됩니다.</h2>
  <div id="qrcode"></div>
</div>

<div id="qrGenerateForm" style="display:none; margin-top:2rem;">
  <p>학번(Mã số lớp): <span id="resultId"></span></p>
  <p>이름(Họ tên): <span id="resultName"></span></p>
  <p>날짜(Ngày hôm nay): <span id="resultDate"></span></p>
  <p>사유(Lý do): <span id="resultReason"></span></p>
  <p>지도 교사(GV chủ nhiệm): <span id="resultTeacher"></span></p>
  <p>출입 여부(Ra vào): <span id="resultEntry"></span></p>
  <p>사용 여부(Đã sử dụng): <span id="resultUse"></span></p>

  <button id="confirmExit">ĐI RA</button>
</div>

<footer class="footer">
  © 2025 Online Entry. All rights reserved.
</footer>

<script>
document.getElementById("generateQR").addEventListener("click", () => {
  const id = studentId.value.trim();
  const name = studentName.value.trim();
  const reason = document.getElementById("reason").value.trim();
  const teacher = document.getElementById("teacher").value;
  const date = document.getElementById("date").value;

  if (!id || !name || !reason || teacher === "선택" || !date) {
    alert("모든 정보를 입력하세요.");
    return;
  }

  const entry = "허가됨(Đã được chấp nhận)";
  const use = "사용 안함(Chưa sử dụng)";

  const base = "https://onlineschoolentry.github.io/onlineschoolentry/entry.html?";
  const params = new URLSearchParams({ id, name, reason, teacher, entry, use, date });

  qrBox.style.display = "block";
  qrcode.innerHTML = "";

  new QRCode(qrcode, {
    text: base + params.toString(),
    width: 256,
    height: 256
  });
});

// entry.html 페이지용 데이터 표시
const url = new URL(window.location.href);
if (url.searchParams.get("id")) {
  resultId.textContent = url.searchParams.get("id");
  resultName.textContent = url.searchParams.get("name");
  resultReason.textContent = url.searchParams.get("reason");
  resultTeacher.textContent = url.searchParams.get("teacher");
  resultDate.textContent = url.searchParams.get("date");
  resultEntry.textContent = url.searchParams.get("entry");
  resultUse.textContent = url.searchParams.get("use");

  document.getElementById("qrGenerateForm").style.display = "block";
}

// 버튼 클릭 시 사용 완료 처리
document.getElementById("confirmExit")?.addEventListener("click", () => {
  alert("확인되었습니다(Đã xác nhận)");
  location.reload();
});
</script>
</body>
</html>
